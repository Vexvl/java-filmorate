DROP TABLE IF EXISTS USERS CASCADE;
DROP TABLE IF EXISTS MPA_RATING CASCADE;
DROP TABLE IF EXISTS GENRES CASCADE;
DROP TABLE IF EXISTS USER_FRIENDS CASCADE;
DROP TABLE IF EXISTS FILMS CASCADE;
DROP TABLE IF EXISTS FILM_GENRE CASCADE;
DROP TABLE IF EXISTS FAVOURITE_FILMS CASCADE;

CREATE TABLE IF NOT EXISTS users
(
    USER_ID  LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMAIL    VARCHAR(100),
    LOGIN    VARCHAR(100),
    NAME     VARCHAR(100),
    BIRTHDAY DATE
);

CREATE TABLE IF NOT EXISTS mpa_rating
(
    ID   LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(40)
);

CREATE TABLE IF NOT EXISTS user_friends
(
    USER_ID             LONG,
    FRIEND_ID           LONG,
    CONFIRMATION_STATUS BOOLEAN DEFAULT FALSE
);

CREATE TABLE IF NOT EXISTS films
(
    FILM_ID       LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME          VARCHAR(100),
    DESCRIPTION   VARCHAR(200),
    RELEASE_DATE  DATE,
    DURATION      LONG,
    MPA_RATING_ID LONG
);

CREATE TABLE IF NOT EXISTS FILM_GENRE
(
    FILM_ID  LONG,
    GENRE_ID LONG
);

CREATE TABLE IF NOT EXISTS GENRES
(
    ID   LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME VARCHAR(40)
);

CREATE TABLE IF NOT EXISTS FAVOURITE_FILMS
(
    FILM_ID LONG,
    USER_ID LONG
);

ALTER TABLE FAVOURITE_FILMS
    ADD CONSTRAINT IF NOT EXISTS fk_favorite_films_film_id FOREIGN KEY (FILM_ID)
        REFERENCES films (FILM_ID);

ALTER TABLE FAVOURITE_FILMS
    ADD CONSTRAINT IF NOT EXISTS fk_favourite_films_user_id FOREIGN KEY (USER_ID)
        REFERENCES users (USER_ID);

ALTER TABLE USER_FRIENDS
    ADD CONSTRAINT IF NOT EXISTS fk_user_friends_user_id FOREIGN KEY (USER_ID)
        REFERENCES users (USER_ID);

ALTER TABLE USER_FRIENDS
    ADD CONSTRAINT IF NOT EXISTS fk_user_friends_friend_id FOREIGN KEY (FRIEND_ID)
        REFERENCES users (USER_ID);

ALTER TABLE FILMS
    ADD CONSTRAINT IF NOT EXISTS fk_film_mpa_rating_id FOREIGN KEY (MPA_RATING_ID)
        REFERENCES mpa_rating (ID);

ALTER TABLE FILM_GENRE
    ADD CONSTRAINT IF NOT EXISTS fk_film_genre_film_id FOREIGN KEY (FILM_ID)
        REFERENCES films (FILM_ID);

ALTER TABLE FILM_GENRE
    ADD CONSTRAINT IF NOT EXISTS fk_film_genre_genre_id FOREIGN KEY (GENRE_ID)
        REFERENCES genres (ID);